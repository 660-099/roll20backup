<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML 코드 수정 및 형식 지정</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f7f7f7; min-height: 100vh; }
        .container { max-width: 1400px; margin: 0 auto; padding: 1rem; }
        textarea { resize: none; min-height: 200px; font-family: monospace; tab-size: 4; -moz-tab-size: 4; white-space: pre-wrap; }
        #inputCode { min-height: 200px; }
        .code-panel { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06); }
        #outputCode { min-height: 400px; }
        .image-table th, .image-table td { padding: 8px 4px; border-bottom: 1px solid #e5e7eb; vertical-align: top; }
        .image-table th:first-child, .image-table td:first-child { width: 100px; }
        .image-table th:nth-child(2), .image-table td:nth-child(2) { width: 40%; }
        .image-table th:last-child, .image-table td:last-child { width: 40%; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container py-8">
        <header class="text-center mb-6">
            <h1 class="text-4xl font-extrabold text-indigo-700 mb-2">HTML 코드 수정 및 형식 지정</h1>
            <p class="text-gray-600">클라이언트 측 JavaScript로 즉시 코드를 수정하고 형식 지정합니다.</p>
        </header>

        <div class="code-panel bg-white p-6 rounded-xl border border-gray-200 mb-6">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4 flex items-center">HTML 코드 입력</h2>
            <textarea id="inputCode" placeholder="여기에 HTML 코드를 붙여넣으세요." class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 transition duration-150"></textarea>
        </div>

        <div class="flex flex-col sm:flex-row justify-center items-center gap-4 mb-8">
            <button id="fixButton" class="px-8 py-3 bg-indigo-600 text-white font-bold rounded-full shadow-lg hover:bg-indigo-700 transition duration-300 ease-in-out transform hover:scale-105 disabled:bg-indigo-400 disabled:cursor-not-allowed" disabled>
                <span id="fixButtonText">코드 수정 및 형식 지정</span>
            </button>
            <div id="statusMessage" class="text-sm font-medium text-gray-600 transition duration-300">시작하려면 위에 HTML 코드를 입력하세요.</div>
        </div>

        <main class="grid lg:grid-cols-4 gap-6">
            <div class="lg:col-span-1 code-panel bg-white p-6 rounded-xl border border-gray-200 h-full">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">수정 옵션</h2>
                
                <div class="mb-6">
                    <label class="block text-gray-700 font-medium mb-2">코드 정리</label>
                    <div class="space-y-2">
                        <label class="flex items-center text-gray-600 hover:text-indigo-600 transition duration-150">
                            <input type="checkbox" id="removeEmpty" class="form-checkbox text-indigo-600 rounded">
                            <span class="ml-2">빈 속성 제거</span>
                        </label>
                    </div>
                </div>

                <div class="mb-6 border-t pt-4 mt-4 border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-700 mb-3">이미지 URL 교체</h2>
                    <button id="parseImagesButton" class="w-full py-2 bg-pink-500 text-white font-semibold rounded-lg hover:bg-pink-600 transition duration-150 disabled:bg-gray-400 disabled:cursor-not-allowed">HTML에서 이미지 목록 가져오기</button>
                    <div id="imageListContainer" class="mt-4 p-3 bg-gray-50 rounded-lg border border-gray-200 max-h-96 overflow-y-auto" style="display: none;">
                        <p id="imageStatus" class="text-sm text-gray-500">이미지 목록을 가져오려면 위에 코드를 입력하고 버튼을 클릭하세요.</p>
                    </div>
                </div>
                
                <div class="mb-6 border-t pt-4 mt-4 border-gray-200">
                    <label class="block text-gray-700 font-medium mb-2">디자인 및 캐릭터 설정</label>
                    <div class="space-y-2">
                        <label class="flex items-center text-indigo-700 font-bold cursor-pointer hover:text-indigo-900 transition duration-150 p-2 bg-indigo-50 rounded-lg border border-indigo-100">
                            <input type="checkbox" id="addClassNames" class="form-checkbox text-indigo-600 rounded" checked>
                            <span class="ml-2">이름을 클래스로 변환 + 자동 채색</span>
                        </label>

                        <label class="flex items-center text-gray-600 font-medium cursor-pointer hover:text-indigo-600 transition duration-150">
                            <input type="checkbox" id="unifyBackgroundColors" class="form-checkbox text-indigo-600 rounded">
                            <span class="ml-2">배경색 통일</span>
                        </label>
                        <label class="flex items-center text-gray-600 font-medium cursor-pointer hover:text-indigo-600 transition duration-150">
                            <input type="checkbox" id="adjustTableWidth" class="form-checkbox text-indigo-600 rounded">
                            <span class="ml-2">표 너비 조절</span>
                        </label>
                         <label class="flex items-center text-gray-600 hover:text-indigo-600 transition duration-150">
                            <input type="checkbox" id="removeFontStyles" class="form-checkbox text-indigo-600 rounded">
                            <span class="ml-2">글꼴 스타일 제거</span>
                        </label>
                    </div>
                </div>

                <p class="text-sm text-gray-500 mt-4 italic"><span class="font-semibold">모든 기능은</span> 클라이언트 측 JavaScript로 즉시 처리됩니다.</p>
            </div>

            <div class="lg:col-span-3 space-y-6">
                <div class="code-panel bg-white p-6 rounded-xl border border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-700 mb-3">형식 지정된 코드</h2>
                    <textarea id="outputCode" readonly placeholder="수정되고 형식 지정된 HTML이 여기에 표시됩니다." class="w-full p-4 border border-gray-300 bg-gray-50 rounded-lg" aria-live="polite"></textarea>
                    <button id="copyButton" class="mt-3 w-full py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition duration-150">클립보드에 복사</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // DOM Elements
        const inputCode = document.getElementById('inputCode');
        const outputCode = document.getElementById('outputCode');
        const fixButton = document.getElementById('fixButton');
        const fixButtonText = document.getElementById('fixButtonText');
        const statusMessage = document.getElementById('statusMessage');
        const copyButton = document.getElementById('copyButton');
        
        // Options
        const removeEmptyCheckbox = document.getElementById('removeEmpty');
        const unifyBackgroundColors = document.getElementById('unifyBackgroundColors');
        const adjustTableWidth = document.getElementById('adjustTableWidth');
        const removeFontStylesCheckbox = document.getElementById('removeFontStyles');
        const addClassNamesCheckbox = document.getElementById('addClassNames'); // [NEW]

        // Image Replacement
        const parseImagesButton = document.getElementById('parseImagesButton');
        const imageListContainer = document.getElementById('imageListContainer');
        
        let imageReplacements = {}; 

        // --- Core Utility Functions ---
        function formatHtmlLocally(html) {
            let formatLevel = 0;
            let formatted = '';
            const tags = /(<\/?\w+.*?>|)/g; 
            const selfClosingTags = /<area|base|br|col|embed|hr|img|input|keygen|link|meta|param|source|track|wbr/i;
            const skipFormattingTags = /<script|style/i;
            let skipFormatting = false; 

            let tempHtml = html.replace(/\s*([a-zA-Z0-9_-]+)\s*=\s*/g, ' $1='); 
            
            tempHtml.split(tags).forEach(node => {
                if (!node.trim()) return;
                const isTag = node.startsWith('<');
                
                if (isTag) {
                    if (node.match(skipFormattingTags)) skipFormatting = !skipFormatting;
                    
                    let indent = '    '.repeat(formatLevel);
                    let isOpeningTag = node.match(/^<\w/);
                    let isClosingTag = node.match(/^<\/\w/);
                    let isSelfClosing = selfClosingTags.test(node) || node.match(/\/>$/) || node.match(/<!DOCTYPE/i) || node.match(/
